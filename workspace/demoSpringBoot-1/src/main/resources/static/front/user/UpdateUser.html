<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<style>
		.main {
			min-height: 60vh;
			/* 让 .slant 至少占据整个视口高度 */
		}

		.img-container {
			height: 340px;
			border: 2px dashed #ccc;
			display: flex;
			align-items: center;
			justify-content: center;
			position: relative;
			border-radius: 50%;
			overflow: hidden;
		}

		.img-container img {
			max-width: 100%;
			max-height: 100%;
			object-fit: cover;
		}

		.img-container img.loaded {
			display: block;
		}

		.form-control {
			max-width: 300px;
			/* 或任何你想要的寬度 */
		}
	</style>
	<link rel="stylesheet" href="OrdersStyles.css">
	<!-- Bootstrap CSS -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
	<script src="https://kit.fontawesome.com/4287c80df9.js" crossorigin="anonymous"></script>

	<!--Google Font : Nunito-->
	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600&display=swap" rel="stylesheet">

	<!-- For style(All CSS content) -->
	<link rel="stylesheet" type="text/css" href="../styles/home.css" />
	<link rel="stylesheet" type="text/css" href="../styles/footer.css" />
	<link rel="stylesheet" type="text/css" href="../styles/navbar.css" />
	<link rel="icon" href="images/favicon.ico">

	<!-- JS Bundle for BS  -->
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
		integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous">
		</script>
	<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
	<title>會員中心</title>
</head>

<body>

	<div class="container-fluid" style="margin-top: 100px;">
		<section id="banner">
			<div class="container">
				<div class="swiper main-swiper swiper-initialized swiper-horizontal swiper-backface-hidden">
					<div class="swiper-wrapper" id="swiper-wrapper-23b1b2123319f4f1" aria-live="polite">

						<div class="swiper-slide py-5 swiper-slide-active" role="group" aria-label="1 / 3"
							style="width: 1116px;">
							<div class="row banner-content align-items-center">
								<div class="img-wrapper col-md-5">
									<img src="" class="img-fluid">
								</div>


							</div>
						</div>
					</div>

				</div>
			</div>
		</section>
	</div>


	<section class="section profile">
		<div class="row">
			<div class="col-xl-4">

				<div class="">
					<div class="profile-card pt-4 d-flex flex-column align-items-center">
						<img src="" alt="未上傳圖片" class="rounded-circle img-fluid w-75" id="picture">
					</div>
				</div>

			</div>

			<div class="col-xl-8">

				<div class="">
					<div class="pt-3" style="background-color:#FCFCFC	;width:90%;border-radius: 20px;">
						<!-- Bordered Tabs -->
						<ul class="nav nav-tabs nav-tabs-bordered">

							<li class="nav-item">
								<button class="nav-link active m-2" data-bs-toggle="tab"
									data-bs-target="#profile-overview">個人資料</button>
							</li>

							<li class="nav-item">
								<button class="nav-link m-2" data-bs-toggle="tab"
									data-bs-target="#profile-edit">會員資料修改</button>
							</li>
							<li class="nav-item">
								<button class="nav-link	m-2" data-bs-toggle="tab"
									data-bs-target="#profile-change-password">重置密碼</button>
							</li>

						</ul>
						<div class="tab-content pt-2">

							<div class="tab-pane fade show active profile-overview" id="profile-overview">

								<h5 class="card-title text-center"> </h5>

								<div class="row">
									<div class="col-lg-3 col-md-4 label h3 text-dark mt-1">姓名:</div>
									<div class="col-lg-9 col-md-8 h3 text-dark									mt-1" id="userName"></div>
								</div>

								<div class="row">
									<div class="col-lg-3 col-md-4 label h3 text-dark									mt-1">暱名:</div>
									<div class="col-lg-9 col-md-8 h3 text-dark									mt-1" id="nickName"></div>
								</div>

								<div class="row">
									<div class="col-lg-3 col-md-4 label h3 text-dark									mt-1">性別:</div>
									<div class="col-lg-9 col-md-8 h3 text-dark									mt-1" id="gender"></div>
								</div>

								<div class="row">
									<div class="col-lg-3 col-md-4 label h3 text-dark									mt-1">生日:</div>
									<div class="col-lg-9 col-md-8 h3 text-dark									mt-1" id="birthday"></div>
								</div>

								<div class="row">
									<div class="col-lg-3 col-md-4 label h3 text-dark									mt-1">電話:</div>
									<div class="col-lg-9 col-md-8 h3 text-dark									mt-1" id="phone"></div>
								</div>

								<div class="row">
									<div class="col-lg-3 col-md-4 label h3 text-dark									mt-1">地址:</div>
									<div class="col-lg-9 col-md-8 h3 text-dark									mt-1" id="address"></div>
								</div>

								<div class="row">
									<div class="col-lg-3 col-md-4 label h3 text-dark									mt-1">Email:</div>
									<div class="col-lg-9 col-md-8 h3 text-dark									mt-1" id="email"></div>
								</div>

								<div class="row">
									<div class="col-lg-3 col-md-4 label h3 text-dark									mt-1">跳舞角色:</div>
									<div class="col-lg-9 col-md-8 h3 text-dark									mt-1" id="danceCharacter"></div>
								</div>

								<div class="row">
									<div class="col-lg-3 col-md-4 label h3 text-dark									mt-1">舞齡:</div>
									<div class="col-lg-9 col-md-8 h3 text-dark									mt-1" id="danceAge"></div>
								</div>



							</div>

							<div class="tab-pane fade profile-edit pt-3" id="profile-edit">

								<!-- Profile Edit Form -->
								<form method="post" action="/Update" enctype="multipart/form-data">
									<input type="hidden" name="_method" value="PUT">

									<div class="row mb-3">
										<label for="fileInput"
											class="custom-file-button col-md-4 col-lg-3 col-form-label text-dark"
											style="font-size: 1.4rem !important;font-weight: bold;">選擇照片</label>
										<input type="file" name="picture" id="fileInput" onchange="display()"
											style="display: none">
										<div class="col-md-5 col-lg-4" style="padding: 0;">
											<img class="imgInput rounded-circle img-fluid w-75" id="profileImage" onclick="fileUpdate()">
										</div>
									</div>

									<div class="row mb-3">
										<label for="userNameU" class="col-md-4 col-lg-3 col-form-label text-dark"
											style="font-size: 1.4rem !important;font-weight: bold;">姓名:</label>
										<div class="col-md-8 col-lg-9" style="max-width: 140px;">
											<input name="userName" type="text" class="form-control" id="userNameU"
												value="">
										</div>
									</div>

									<div class="row mb-3">
										<label for="nickNameU" class="col-md-4 col-lg-3 col-form-label text-dark"
											style="font-size: 1.4rem !important;font-weight: bold;">暱名:</label>
										<div class="col-md-8 col-lg-9" style="max-width: 180px;">
											<input name="nickName" type="text" class="form-control" id="nickNameU"
												value="">
										</div>
									</div>

									<div class="row mb-3">
										<label for="gender" class="col-md-4 col-lg-3 col-form-label text-dark"
											style="font-size: 1.4rem !important;font-weight: bold;">性別:</label>
										<div class="col-md-8 col-lg-9" style="max-width: 100px;">
											<select name="gender" class="form-select" id="genderU">
												<option value="男">男</option>
												<option value="女">女</option>
											</select>
										</div>
									</div>

									<div class="row mb-3">
										<label for="birthdayU" class="col-md-4 col-lg-3 col-form-label text-dark"
											style="font-size: 1.4rem !important;font-weight: bold;">生日:</label>
										<div class="col-md-8 col-lg-9" style="max-width: 200px;">
											<input name="birthday" type="date" class="form-control" id="birthdayU"
												value="">
										</div>
									</div>

									<div class="row mb-3">
										<label for="phoneU" class="col-md-4 col-lg-3 col-form-label text-dark"
											style="font-size: 1.4rem !important;font-weight: bold;">電話:</label>
										<div class="col-md-8 col-lg-9" style="max-width: 200px;">
											<input name="phone" type="text" class="form-control" id="phoneU" value="">
										</div>
									</div>

									<div class="row mb-3">
										<label for="addressU" class="col-md-4 col-lg-3 col-form-label text-dark"
											style="font-size: 1.4rem !important;font-weight: bold;">地址:</label>
										<div class="col-md-8 col-lg-9">
											<input name="address" type="text" class="form-control" id="addressU"
												value="">
										</div>
									</div>

									<div class="row mb-3">
										<label for="danceCharacterU" class="col-md-4 col-lg-3 col-form-label text-dark"
											style="font-size: 1.4rem !important;font-weight: bold;">跳舞角色:</label>
										<div class="col-md-8 col-lg-9" style="max-width: 160px;">
											<select name="danceCharacter" type="text" class="form-control"
												id="danceCharacterU">
												<option value="">請選擇角色</option>
												<option value="leader">Leader</option>
												<option value="follower">Follower</option>
											</select>
										</div>
									</div>

									<div class="row mb-3">
										<label for="danceAgeU" class="col-md-4 col-lg-3 col-form-label text-dark"
											style="font-size: 1.4rem !important;font-weight: bold;">舞齡:</label>
										<div class="col-md-8 col-lg-9" style="max-width: 100px;">
											<input name="danceAge" type="number" class="form-control" id="danceAgeU"
												min="1" max="50" value="">
										</div>
									</div>



									<div class="text-center">
										<button type="submit" class="btn btn-primary">儲存</button>
									</div>
							</div>
							</form><!-- End Profile Edit Form -->



							<div class="tab-pane fade pt-3" id="profile-change-password">
								<!-- Change Password Form -->
								<form method="post" action="/UpdatePassword">
									<input type="hidden" name="_method" value="PUT">

									<div class="row mb-3">
										<label for="currentPassword" class="col-md-4 col-lg-3 col-form-label text-dark"
											style="font-size: 1.4rem !important;font-weight: bold;">目前密碼</label>
										<div class="col-md-8 col-lg-9">
											<input name="password" type="password" class="form-control"
												id="currentPassword">
											<div id="passwordMessage" class="text-danger mt-2"></div>
										</div>
									</div>

									<div class="row mb-3">
										<label for="newPassword" class="col-md-4 col-lg-3 col-form-label text-dark"
											style="font-size: 1.4rem !important;font-weight: bold;">新密碼</label>
										<div class="col-md-8 col-lg-9">
											<input name="newpassword" type="password" class="form-control"
												id="newPassword">
										</div>
									</div>

									<div class="row mb-3">
										<label for="renewPassword" class="col-md-4 col-lg-3 col-form-label text-dark"
											style="font-size: 1.4rem !important;font-weight: bold;">確認密碼</label>
										<div class="col-md-8 col-lg-9">
											<input name="renewpassword" type="password" class="form-control"
												id="renewPassword">
											<div id="newPasswordMessage" class="text-danger mt-2"></div>
										</div>
									</div>

									<div class="text-center">
										<button type="submit" class="btn btn-primary" id="resetPasswordButton"
											style="display: none;">重置密碼</button>
									</div>
								</form><!-- End Change Password Form -->
							</div>
						</div><!-- End Bordered Tabs -->
					</div>
				</div>
			</div>
		</div>

	</section>



	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous">
		</script>
	<script>
		fetch('../basic.html')
			.then(response => response.text())
			.then(html => {
				document.body.innerHTML += html;
				$('#memberDropdown').attr("style", "display: none");
				$('#loginButton').attr("style", "display: block");

				fetch('/checkUserLogin')
					.then(response => {
						if (!response.ok) {
							throw new Error('Network response was not ok');
						}
						return response.json();
					})
					.then(data => {
						console.log('成功');
						$('#memberDropdown').show();
						$('#loginButton').hide();

						//資料放入h2標籤
						document.querySelector('#userName').textContent = data.username;
						document.querySelector('#userNameU').value = data.username;
						document.querySelector('#email').textContent = data.email;

						let nicknameElement = document.querySelector('#nickName');
						if (data.nickname) {
							nicknameElement.textContent = data.nickname;
							document.querySelector('#nickNameU').value = data.nickname;
						} else {
							nicknameElement.textContent = "無";
						}
						let genderElement = document.querySelector('#gender');
						if (data.gender) {
							genderElement.textContent = data.gender;

							document.querySelector('#genderU').value = data.gender;

						} else {
							genderElement.textContent = "無";
						}
						let birthdayElement = document.querySelector('#birthday');
						if (data.birthday) {
							birthdayElement.textContent = data.birthday;
							document.querySelector('#birthdayU').value = data.birthday;
						} else {
							birthdayElement.textContent = "無";
						}
						let danceCharacterElement = document.querySelector('#danceCharacter');
						if (data.danceCharacter) {
							danceCharacterElement.textContent = data.danceCharacter;
							document.querySelector('#danceCharacterU').value = data.danceCharacter;
						} else {
							danceCharacterElement.textContent = "無";
						}
						let danceAgeElement = document.querySelector('#danceAge');
						if (data.danceAge) {
							danceAgeElement.textContent = data.danceAge;
							document.querySelector('#danceAgeU').value = data.danceAge;
						} else {
							danceAgeElement.textContent = "無";
						}
						let phoneElement = document.querySelector('#phone');
						if (data.phone) {
							phoneElement.textContent = data.phone;
							document.querySelector('#phoneU').value = data.phone;
						} else {
							phoneElement.textContent = "無";
						}
						let addressElement = document.querySelector('#address');
						if (data.address) {
							addressElement.textContent = data.address;
							document.querySelector('#addressU').value = data.address;
						} else {
							addressElement.textContent = "無";
						}


						const picture = data.picture;
						if (picture) {
							document.querySelector('#picture').src = picture;
							document.querySelector('#profileImage').src = picture;
						}

					})
					.catch(error => {
						console.error('失敗', error);
						$('#memberDropdown').hide();
						$('#loginButton').show();
						window.location.href = '/UserLoginTest';
					});

			});
		let isCurrentPasswordValid = false;
		let isNewPasswordValid = false;

		$(document).on('input', '#currentPassword', function () {
			var password = $(this).val();
			console.log(password);
			$.ajax({
				url: '/validatePassword',
				type: 'POST',
				data: {password: password},
				success: function () {
					$('#passwordMessage').text('密碼正確').removeClass('text-danger').addClass('text-success');
					isCurrentPasswordValid = true;
					toggleResetButton();
				},
				error: function () {
					$('#passwordMessage').text('密碼錯誤').removeClass('text-success').addClass('text-danger');
					isCurrentPasswordValid = false;
					toggleResetButton();
				}
			});
		});

		$(document).on('input', '#renewPassword', function () {
			var renewPassword = $(this).val();
			var newPassword = $('#newPassword').val();
			var currentPassword = $('#currentPassword').val();
			if (renewPassword === newPassword) {
				if (renewPassword === currentPassword) {
					$('#newPasswordMessage').text('和目前密碼相同').removeClass('text-success').addClass('text-danger');
					isNewPasswordValid = false;
					toggleResetButton();
				} else {
					$('#newPasswordMessage').text('新密碼正確').removeClass('text-danger').addClass('text-success');
					isNewPasswordValid = true;
					toggleResetButton();
				}

			} else {
				$('#newPasswordMessage').text('請重新輸入').removeClass('text-success').addClass('text-danger');
				isNewPasswordValid = false;
				toggleResetButton();
			}

		});

		function toggleResetButton() {
			if (isCurrentPasswordValid && isNewPasswordValid) {
				$('#resetPasswordButton').show();
			} else {
				$('#resetPasswordButton').hide();
			}
		}


		function display() {
			let fileInput = $('#fileInput');
			let img = $('.imgInput');

			if (fileInput[0].files && fileInput[0].files[0]) {
				let reader = new FileReader();
				reader.onload = function (e) {
					img.attr('src', e.target.result);
					img.addClass('loaded'); // 添加 'loaded' 類
				};
				reader.readAsDataURL(fileInput[0].files[0]);
			}
		}

		function fileUpdate() {
			document.getElementById('fileInput').click();
		}
	</script>
</body>

</html>