<!doctype html>
<html lang="en">

<head>
	<!-- 本頁網址http://localhost:8080/front/event/EventDetail.html -->
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- Bootstrap CSS -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
	<script src="https://kit.fontawesome.com/4287c80df9.js" crossorigin="anonymous"></script>

	<!--Google Font : Nunito-->
	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600&display=swap" rel="stylesheet">

	<!-- For style(All CSS content) -->
	<link rel="stylesheet" type="text/css" href="../styles/home.css" />
	<link rel="stylesheet" type="text/css" href="../styles/footer.css" />
	<link rel="stylesheet" type="text/css" href="../styles/navbar.css" />
	<link rel="icon" href="../images/favicon.ico">
	<link rel="stylesheet" href="../styles/Timerstyles.css" />

	<!-- JS Bundle for BS  -->
	<script src="https://code.jquery.com/jquery-3.7.1.js"
		integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
		integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
		crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"
		integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF"
		crossorigin="anonymous"></script>

	<link href="
https://cdn.jsdelivr.net/npm/sweetalert2@11.10.8/dist/sweetalert2.min.css
" rel="stylesheet">

	<title>JFSwing Website</title>
	<style>
		.map-container {
			margin-top: 2px;
			/* 調整這個值來增加或減少距離 */
		}
	</style>



</head>

<body>

	<!-- Shashank's Section -->
	<!-- <section class="title"> -->
	<!-- Navbar section -->


	<!-- Title -->
	<div class="container-fluid" style="margin-top: 150px;">
		<div id="title">
			<div class="row">
				<div class="col-1"></div>
				<div class="col-5" id="fetchPicture">
					<!-- <img src="https://dance-teacher.com/wp-content/uploads/2020/12/the-most-romantic-dance-movie-scenes-of-all-time.jpg"
                        class="d-block" style="width:100%"> -->
				</div>
				<div class="col-5">
					<h3 class="neon-yellow">距離活動開始時間</h3>
					<div id="countdown" class="countdown">

						<div class="time">
							<h2 id="days"></h2>
							<small>Days</small>
						</div>

						<div class="time">
							<h2 id="hours"></h2>
							<small>Hours</small>
						</div>

						<div class="time">
							<h2 id="minutes"></h2>
							<small>Minutes</small>
						</div>

						<div class="time">
							<h2 id="seconds"></h2>
							<small>Seconds</small>
						</div>

					</div>
					<table class="table table-dark table-hover">
						<tbody id="eventTable">
							<!-- <button onclick="getData();">取得資料</button> -->
							<!-- fetch append表格的位置 -->
						</tbody>
					</table>

					<div class="row">
						<div class="col">

							<button onclick="buy()" class="btn btn-primary">立即報名</button>

						</div>
						<div class="col">

							<form id="eventCollectionForm">
								<!-- 							action="../eventCollection" -->
								<!-- 								method="post" -->
								<!-- 								                        <input type="hidden" id="eventDate" name="EVENT_STARTIME" value=${startTime}>  -->
								<!-- 								                         <input type="hidden" id="eventName" name="EVENT_NAME" value=${eventName}> -->
								<button class="btn btn-primary" type="submit">收藏活動到email</button>
							</form>

						</div>

					</div>


					<div class="row" style="margin:0;">


						<div style="display:flex;margin:20px">
							<h3 class="neon-yellow">活<br>動<br>地<br>點</h3>
							<div id="map" style="width:100%;height:50vh;"></div>
							<!--							<iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3614.7276604777917!2d121.50703081116819!3d25.043314737823437!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3442a909a4acec8b%3A0x7c34275cfedcc1c5!2z6KW_6ZaA57SF5qiT!5e0!3m2!1szh-TW!2stw!4v1716540403367!5m2!1szh-TW!2stw" width="600" height="450" style="border:0;margin:20px;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>-->
						</div>
					</div>

				</div>

				<div class="row">
					<div class="col-1"></div>
					<div class="col-8">
						<h3 class="neon-yellow">活動詳細資料</h3>
						<div id="fetchDetails"></div>

					</div>
				</div>
			</div>
		</div>
	</div>






	<!-- Optional JavaScript; choose one of the two! -->

	<!-- Option 1: Bootstrap Bundle with Popper -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
		crossorigin="anonymous"></script>

	<script src="Timer.js"></script>
	<!-- Timer -->
	<script>
		const queryString = window.location.search;
		const urlParams = new URLSearchParams(queryString);

		var evenID = urlParams.get("ID");


		console.log(evenID);
		$(function () {

			getTimer();
		}); //windows.onload
	</script>


	<script>

		// const queryString = window.location.search;
		// const urlParams = new URLSearchParams(queryString);

		// let evenID = urlParams.get("ID");
		// console.log(evenID);
		getData();

		function getData() {

			fetch("/ajaxFindEvenDataByID/" + evenID).then(function (response) {
				return response.json();
			}).then(function (data) {
				$('#eventCollectionForm').append(`<input type="hidden" name="EVENT_STARTIME" id="eventDate" value=${data.startTime}>
            		    <input type="hidden" id="eventName" value=${data.eventName} name="EVENT_NAME">`)

				$('#fetchPicture').append(`<img src="${data.picture}"
                        class="d-block" style="width:100%">`)

				$('#fetchDetails').append(`<p>${data.eventDetail}</p>`)


				$('#eventTable').append(`<tr>
                                <td class="vertical-header border-bottom">活動編號</td>
                                <td>${data.eventId}</td>
                            </tr>
                            <tr>
                                <td class="vertical-header border-bottom">活動名稱</td>
                                <td>${data.eventName}</td>
                            </tr>
                            <tr>
                                <td class="vertical-header border-bottom">報名開始日期</td>
                                <td>${data.signupStartime}</td>
                            </tr>
                            <tr>
                                <td class="vertical-header border-bottom">報名結束日期</td>
                                <td>${data.signupEndtime}</td>
                            </tr>
                            <tr>
                                <td class="vertical-header border-bottom">活動開始時間</td>
                                <td>${data.startTime}</td>
                            </tr>
                            <tr>
                                <td class="vertical-header border-bottom">活動結束時間</td>
                                <td>${data.endTime}</td>
                            </tr>
                            <tr>
                                <td class="vertical-header border-bottom">活動種類</td>
                                <td>${data.eventCategory}</td>
                            </tr>
                            <tr>
                                <td class="vertical-header border-bottom">報名金額</td>
                                <td>${data.eventPrice}</td>
                            </tr>
                            <tr>
                                <td class="vertical-header border-bottom">活動地址</td>
                                <td id="address">${data.eventLocation}</td>
                            </tr>
                            <tr>
                                <td class="vertical-header border-bottom">組織者</td>
                                <td>${data.organizer}</td>
                            </tr>`)

			}).then(function(){
				console.log("嘗試抓地址 : " + $("#address").text());
				initMap();
			});
		}



	</script>
	<script src="
		https://cdn.jsdelivr.net/npm/sweetalert2@11.10.8/dist/sweetalert2.all.min.js
		"></script>
	<script async
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDAgqI1p1boHUwEIE395YECgaaYngF9FIE&libraries=places&callback=initMap&region=TW&language=zh-TW">
		</script>
	<!-- Map -->

	<script>

		function getLatLngFromAddress(address) {
			return new Promise((resolve, reject) => {
				var geocoder = new google.maps.Geocoder();
				geocoder.geocode({'address': address}, function (results, status) {
					if (status == google.maps.GeocoderStatus.OK) {
						var latitude = results[0].geometry.location.lat();
						var longitude = results[0].geometry.location.lng();
						resolve({lat: latitude, lng: longitude});
					} else {
						reject(new Error('Geocoding failed: ' + status));
					}
				});
			});
		}

		window.onload = function () { };



		function initMap() {
			var addressText = $("#address").text();
			console.log("google抓地址 : " + addressText);


			getLatLngFromAddress(addressText)
				.then(latLng => {
					console.log('Latitude:', latLng.lat);
					console.log('Longitude:', latLng.lng);

					var mapOptions = {
						center: {lat: latLng.lat, lng: latLng.lng}, // 設置地圖的中心位置
						zoom: 17 // 設置地圖的縮放級別
					};

					var map = new google.maps.Map(document.getElementById('map'), mapOptions);

					var marker = new google.maps.Marker({
						position: {lat: latLng.lat, lng: latLng.lng},
						map: map,
						title: '地址'
					});
				})
				.catch(error => {
					console.error('Error:', error.message);
				});
		};







	</script>




	<script>

		function buy() {
			var url = "http://localhost:8080/orders"; // 請求的 URL

			fetch("/ajaxFindEvenDataByID/" + evenID).then(function (response) {
				return response.json();
			}).then(function (data) {

				if (data.userId != null) {

					var jsonObject = {
						productNum: data.eventId,
						productName: data.eventName,
						productPrice: data.eventPrice,
						productQuantity: '1',
						orderTotalPrice: data.eventPrice
					};

					console.log(jsonObject);

					let dataTest = {
						"userContactNew": {"contactId": data.userId},
						"orderNote": "",
						"orderDetails": [jsonObject]
					};


					// 使用 fetch 函數發送 POST 請求
					fetch(url, {
						method: "POST", // 使用 POST 方法
						body: JSON.stringify(dataTest), // 將 JSON 數據轉換為字符串並指定為請求主體
						headers: new Headers({
							"Content-Type": "application/json", // 指定 Content-Type 為 application/json
						}),
					})
						.then((res) => res.json()) // 解析服務器的 JSON 響應
						.catch((error) => {
							console.error("Error:", error); swal.fire("Error", "加入購物車的過程發生錯誤", "error");

						}) // 處理錯誤
						.then((response) => {
							console.log("Success:", response); swal.fire({title: "已加入購物車", html: `跳轉點擊 <a href="http://localhost:8080/front/order/OrderForClient.html">結帳畫面</a>`, icon: "success"});

						}); // 處理成功響應

				} else {
					swal.fire("Error", "您尚未登入", "error");
				}


			}

			);
		}

	</script>

	<script>

		$(document).ready(function () {
			$("#eventCollectionForm").submit(function (event) {
				// 阻止表單默認提交行為
				event.preventDefault();

				// 獲取表單數據
				var eventDate = $("#eventDate").val();
				var eventName = $("#eventName").val();

				// 發送Ajax請求
				$.ajax({
					type: "POST",
					url: "/eventCollection",
					data: {
						EVENT_STARTIME: eventDate,
						EVENT_NAME: eventName
					},
					success: function (response) {
						// 成功處理返回的數據
						console.log("活動收藏成功");

						swal.fire("Success", "活動收藏成功", "success");
					},
					error: function (xhr, status, error) {
						// 處理錯誤情況
						console.error("活動收藏失敗:", error);
						swal.fire("您尚未登入", "活動收藏失敗", "error");
					}
				});
			});
		});


		function eventCollection() {
			var form = document.getElementById("eventCollectionForm");
			form.submit();
		}

	</script>

	<script>

		//         fetch('basic.html')
		//             .then(response => response.text())
		//             .then(html => {
		//                 document.body.innerHTML += html;
		//             });
		fetch('../basic.html')
			.then(response => response.text())
			.then(html => {
				document.body.insertAdjacentHTML('beforeend', html);
			});




	</script>
			<script src="/html/LoginUser.js"></script>
</body>

</html>